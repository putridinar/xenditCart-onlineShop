---
layout: default
Title: Edit Produk
permalink: /dashboard/edit-product
---
<h2>Edit Produk</h2>

<form id="editProductForm">
  <div>
    <label>Nama Produk</label>
    <input type="text" id="productName" required>
  </div>

  <div>
    <label>Harga Produk (Rp)</label>
    <input type="number" id="productPrice" required>
  </div>

  <div>
    <label>Kategori</label>
    <input type="text" id="productCategory" required>
  </div>

  <div>
    <label>URL Gambar</label>
    <input type="url" id="productImage" required>
  </div>

  <div>
    <label>Warna Produk (pisahkan dengan koma)</label>
    <input type="text" id="productColors" required>
  </div>

  <div>
    <label>Ukuran Produk (pisahkan dengan koma)</label>
    <input type="text" id="productSizes" required>
  </div>

  <button type="submit">Simpan Perubahan</button>
</form>

<div id="statusMessage"></div>

<button id="logoutBtn" class="btn btn-danger mt-4">Logout</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDN2dgu-Sdsc9K5fermxPFwDUiCzX71ce8",
  authDomain: "tokoputridinar.firebaseapp.com",
  projectId: "tokoputridinar",
  storageBucket: "tokoputridinar.firebasestorage.app",
  messagingSenderId: "747234240117",
  appId: "1:747234240117:web:a87af4f6724ab87ad23a3c",
  measurementId: "G-M2JGJH3NVQ"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

onAuthStateChanged(auth, (user) => {
  if (!user) {
    window.location.href = "/login";
  } else {
    loadProductData();
  }
});

document.getElementById("logoutBtn").addEventListener("click", () => {
  signOut(auth).then(() => {
    alert("Logout berhasil!");
    window.location.href = "/login";
  });
});

const form = document.getElementById("editProductForm");
const statusMsg = document.getElementById("statusMessage");
const params = new URLSearchParams(window.location.search);
const productId = params.get("id");

async function loadProductData() {
  if (!productId) {
    statusMsg.textContent = "Produk tidak ditemukan.";
    return;
  }

  try {
    const productRef = doc(db, "products", productId);
    const productSnap = await getDoc(productRef);

    if (productSnap.exists()) {
      const data = productSnap.data();
      document.getElementById("productName").value = data.name;
      document.getElementById("productPrice").value = data.price;
      document.getElementById("productCategory").value = data.category;
      document.getElementById("productImage").value = data.image;
      document.getElementById("productColors").value = data.colors.join(", ");
      document.getElementById("productSizes").value = data.sizes.join(", ");
    } else {
      statusMsg.textContent = "Produk tidak ditemukan di database.";
    }
  } catch (error) {
    statusMsg.textContent = `Gagal load data: ${error.message}`;
  }
}

form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const name = document.getElementById("productName").value.trim();
  const price = parseInt(document.getElementById("productPrice").value);
  const category = document.getElementById("productCategory").value.trim();
  const image = document.getElementById("productImage").value.trim();
  const colors = document.getElementById("productColors").value.split(",").map(c => c.trim()).filter(Boolean);
  const sizes = document.getElementById("productSizes").value.split(",").map(s => s.trim()).filter(Boolean);

  try {
    await updateDoc(doc(db, "products", productId), {
      name, price, category, image, colors, sizes
    });

    alert("✅ Produk berhasil diperbarui!");
    window.location.href = "/dashboard/list-product";  // <-- auto redirect ke list produk

  } catch (error) {
    alert(`❌ Gagal update produk: ${error.message}`);
  }
});
</script>
